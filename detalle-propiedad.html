<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Detalle de Propiedad | PORTAL3.3</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Detalle completo de la propiedad con fotos, caracter√≠sticas y precios.">
  <meta name="keywords" content="propiedades, inmuebles, venta, arriendo, residencial, comercial">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="PORTAL3.3 | Detalle de Propiedad">
  <meta property="og:description" content="Ver detalles completos de la propiedad">
  <meta property="og:image" content="img/logo-portal33Logo.png">
  <meta property="og:type" content="website">
  
  <!-- CSS -->
  <link rel="stylesheet" href="styles.css">
</head>
<script src="header.js"></script>
<script src="menu-mobile.js"></script> <!-- NUEVO -->


<body>

<!-- =======================================
     HEADER - NAVEGACI√ìN PRINCIPAL
     ======================================= -->
  
<header id="main-header">
  <div class="container nav">
    <div class="logo">
      <img src="img/logo-portal33Logo.png" alt="Portal3.3 - Inmobiliaria">
    </div>
    <nav class="menu">
      <a href="index.html">INICIO</a>
      <a href="propiedades.html">PROPIEDADES</a>
      <a href="captacion.html">PUBLICA TU PROPIEDAD</a>
      <a href="blog.html">BLOG</a>
      <a href="notificaciones.html">NOTIFICACIONES / B√öSQUEDA</a>
    </nav>
  </div>
</header>

<!-- =======================================
     CONTENIDO PRINCIPAL
     ======================================= -->
<div class="detalle-container" id="detalleContainer">

  <nav class="breadcrumb">
    <a href="index.html">Inicio</a> &gt; 
    <a href="propiedades.html">Propiedades</a> &gt; 
    <span>Detalle</span>
  </nav>

  <!-- Bot√≥n Volver -->
  <a href="propiedades.html" class="btn-volver">
    ‚Üê Volver al listado
  </a>
  
  <!-- Mensaje de carga inicial -->
  <div class="mensaje-carga" id="mensajeCarga">
    <h2>Cargando informaci√≥n de la propiedad...</h2>
    <div class="loading-box" style="position: static; transform: none; margin: 20px auto;"></div>
  </div>
  
  <!-- Contenido de la propiedad (se llena con JavaScript) -->
  <div id="contenidoPropiedad" style="display: none;">
    
    <!-- Galer√≠a de Fotos -->
    <section class="galeria-section">
      <div class="foto-principal" id="fotoPrincipal">
        <img src="" alt="Foto principal de la propiedad" id="imgPrincipal">
      </div>
      <div class="thumbnails" id="thumbnailsContainer"></div>
    </section>
    
    <!-- Grid de Informaci√≥n -->
    <div class="info-grid">
      
      <!-- Informaci√≥n Principal -->
      <div class="info-principal">
        <h1 id="propTitulo">T√≠tulo de la propiedad</h1>
        <div class="ubicacion">
          <span>üìç</span>
          <span id="propUbicacion">Ciudad, Barrio</span>
        </div>
        <div class="tipo-badge" id="propTipo">Tipo</div>
        
        <!-- Caracter√≠sticas Principales -->
        <div class="caracteristicas">
          <div class="caracteristica-item">
            <span class="icono">üìê</span>
            <span class="valor" id="propArea">0</span>
            <span class="label">m¬≤ √Årea</span>
          </div>
          <div class="caracteristica-item">
            <span class="icono">üõèÔ∏è</span>
            <span class="valor" id="propHabitaciones">0</span>
            <span class="label">Habitaciones</span>
          </div>
          <div class="caracteristica-item">
            <span class="icono">üöø</span>
            <span class="valor" id="propBanos">0</span>
            <span class="label">Ba√±os</span>
          </div>
          <div class="caracteristica-item">
            <span class="icono">üöó</span>
            <span class="valor" id="propParqueaderos">0</span>
            <span class="label">Parqueaderos</span>
          </div>
        </div>
        
        <!-- Descripci√≥n -->
        <div class="descripcion-section">
          <h3>Descripci√≥n</h3>
          <p id="propDescripcion">Descripci√≥n de la propiedad...</p>
        </div>
      </div>
      
      <!-- Sidebar de Contacto -->
      <div class="sidebar-contacto">
        <div class="precio-principal" id="propPrecioVenta">$0</div>
        <span class="precio-label" id="propEstadoVenta">Precio de venta</span>
        
        <div class="precio-secundario" id="precioArriendoBox" style="display: none;">
          <span class="label">Precio de arriendo</span>
          <span class="valor" id="propPrecioArriendo">$0</span>
        </div>
        
        <div class="detalle-extra">
          <div class="detalle-extra-item">
            <span class="label">Estrato:</span>
            <span class="valor" id="propEstrato">-</span>
          </div>
          <div class="detalle-extra-item">
            <span class="label">Administraci√≥n:</span>
            <span class="valor" id="propAdministracion">-</span>
          </div>
          <div class="detalle-extra-item">
            <span class="label">Clasificaci√≥n:</span>
            <span class="valor" id="propClasificacion">-</span>
          </div>
        </div>
        
        <button class="btn-whatsapp" id="btnWhatsapp">
          <span style="font-size: 1.5rem;">üì±</span>
          Contactar por WhatsApp
        </button>
      </div>
      
    </div>
    
  </div>
  
</div>

<!-- =======================================
     FOOTER
     ======================================= -->
<footer>
  <div class="container footer-grid">
    <div><h4>Contacto</h4><p>WhatsApp</p><p>Email</p></div>
    <div><h4>Redes</h4><p>Instagram</p><p>LinkedIn</p></div>
    <div>
    <h4>Agente</h4>
       <div class="agent-photo">
       <img src="img/Foto-perfil.png" alt="Agente">
      </div>
      <p style="margin-top:5px; font-weight:bold;">Mar√≠a Patricia Renta</p>
    </div>
  </div>
  <div class="footer-slogan">Conocimiento local. Estrategia inmobiliaria. Resultados reales.</div>
</footer>

<!-- =======================================
     JAVASCRIPT - CORREGIDO COMO ARTICULO.HTML
     ======================================= -->
<script>
  // ===== CONFIGURACI√ìN =====
  const PROPIEDADES_ENDPOINT = "https://script.google.com/macros/s/AKfycbyjwA8PvQpuKFcSR5D4o_NrP-Mg9C73lATGeC64I7s2wA2ZWcF8Htx1ez2LJhatHMSrOQ/exec";
  const WHATSAPP_NUMBER = "573001234567"; // ‚ö†Ô∏è CAMBIA ESTE N√öMERO
  
  // ===== FUNCI√ìN PRINCIPAL: Cargar Propiedad desde API =====
  async function cargarPropiedad() {
    const mensajeCarga = document.getElementById('mensajeCarga');
    const contenidoPropiedad = document.getElementById('contenidoPropiedad');
    
    // Obtener c√≥digo desde URL (igual que articulo.html)
    const params = new URLSearchParams(window.location.search);
    const codigo = params.get("codigo");
    
    if (!codigo) {
      mostrarError('No se especific√≥ el c√≥digo de la propiedad');
      return;
    }
    
    console.log('üîç Buscando propiedad con c√≥digo:', codigo);
    
    try {
      // Mostrar loading
      mensajeCarga.style.display = 'block';
      contenidoPropiedad.style.display = 'none';
      
      // Hacer fetch al endpoint (igual que blog)
      const response = await fetch(PROPIEDADES_ENDPOINT);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      console.log('‚úÖ Datos recibidos:', data.length, 'propiedades');
      
      // Buscar la propiedad por c√≥digo (igual que articulo.html busca por c√≥digo)
      const propiedad = data.find(p => 
        p["C√ìDIGO"]?.trim() === codigo.trim() &&
        String(p["Activo (si/no)"]).toLowerCase() === "si"
      );
      
      if (!propiedad) {
        mostrarError('Propiedad no encontrada o inactiva');
        return;
      }
      
      console.log('‚úÖ Propiedad encontrada:', propiedad["T√≠tulo"]);
      
      // Renderizar la propiedad
      renderizarPropiedad(propiedad);
      
      // Ocultar loading y mostrar contenido
      mensajeCarga.style.display = 'none';
      contenidoPropiedad.style.display = 'block';
      
    } catch (error) {
      console.error('‚ùå Error cargando propiedad:', error);
      mostrarError('Error al cargar la informaci√≥n de la propiedad');
    }
  }
  
  // ===== RENDERIZAR TODA LA INFORMACI√ìN =====
  function renderizarPropiedad(prop) {
    // ===== T√çTULO Y UBICACI√ìN =====
    document.getElementById('propTitulo').textContent = prop["T√≠tulo"] || "Sin t√≠tulo";
    
    const ciudad = prop["Ciudad"] || "";
    const barrio = prop["Barrio/Sector"] || "";
    document.getElementById('propUbicacion').textContent = `${ciudad}${barrio ? ', ' + barrio : ''}`;
    
    // ===== TIPO =====
    const tipo = prop["Tipo"] || "Propiedad";
    const clasificacion = prop["Residencial / Comercial"] || "";
    document.getElementById('propTipo').textContent = `${tipo} ${clasificacion}`;
    
    // ===== CARACTER√çSTICAS =====
    document.getElementById('propArea').textContent = prop["√Årea m2"] || "0";
    document.getElementById('propHabitaciones').textContent = prop["Habitaciones"] || "0";
    document.getElementById('propBanos').textContent = prop["Ba√±os"] || "0";
    document.getElementById('propParqueaderos').textContent = prop["Parqueaderos"] || "0";
    
    // ===== DESCRIPCI√ìN =====
    document.getElementById('propDescripcion').textContent = prop["Descripci√≥n"] || "Sin descripci√≥n disponible.";
    
    // ===== PRECIOS =====
    const estado = prop["Estado"] || "";
    const precioVenta = prop["Precio Venta COP"] || "";
    const precioArriendo = prop["Precio Arriendo COP"] || "";
    
    // Precio principal
    if (estado.includes("Venta") && precioVenta) {
      document.getElementById('propPrecioVenta').textContent = precioVenta;
      document.getElementById('propEstadoVenta').textContent = "Precio de venta";
    } else if (estado.includes("Arriendo") && precioArriendo) {
      document.getElementById('propPrecioVenta').textContent = precioArriendo;
      document.getElementById('propEstadoVenta').textContent = "Precio de arriendo";
    } else {
      document.getElementById('propPrecioVenta').textContent = "Consultar";
      document.getElementById('propEstadoVenta').textContent = "Precio";
    }
    
    // Precio secundario (si tiene ambos)
    if (estado.includes("Venta") && estado.includes("Arriendo") && precioArriendo) {
      document.getElementById('precioArriendoBox').style.display = 'block';
      document.getElementById('propPrecioArriendo').textContent = precioArriendo;
    }
    
    // ===== DETALLES EXTRA =====
    document.getElementById('propEstrato').textContent = prop["Estrato"] || "-";
    document.getElementById('propAdministracion').textContent = prop["Administraci√≥n"] || "-";
    document.getElementById('propClasificacion').textContent = prop["Residencial / Comercial"] || "-";
    
    // ===== GALER√çA DE FOTOS =====
    cargarGaleria(prop);
    
    // ===== BOT√ìN WHATSAPP =====
    const btnWhatsapp = document.getElementById('btnWhatsapp');
    btnWhatsapp.onclick = () => {
      const titulo = prop["T√≠tulo"] || "esta propiedad";
      const codigoProp = prop["C√ìDIGO"] || "";
      const mensaje = `Hola! Estoy interesado en la propiedad *${codigoProp}*: ${titulo}`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, '_blank');
    };
  }
  
  // ===== NORMALIZAR URLs DE GOOGLE DRIVE =====
  function normalizarFoto(url) {
    if (!url) return null;
    
    let m = url.match(/id=([a-zA-Z0-9_-]+)/);
    if (!m) m = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
    if (!m) return url;
    
    return "https://drive.google.com/thumbnail?id=" + m[1] + "&sz=w1200";
  }
  
  // ===== CARGAR GALER√çA DE FOTOS =====
  function cargarGaleria(prop) {
    const fotosArray = [];
    
    // Recopilar todas las fotos (Foto 1 hasta Foto 8)
    for (let i = 1; i <= 8; i++) {
      const fotoKey = `Foto ${i}`;
      if (prop[fotoKey]) {
        const fotoNormalizada = normalizarFoto(prop[fotoKey]);
        if (fotoNormalizada) {
          fotosArray.push(fotoNormalizada);
        }
      }
    }
    
    // Si no hay fotos, usar placeholder
    if (fotosArray.length === 0) {
      fotosArray.push('https://via.placeholder.com/1200x800?text=Sin+Imagen');
    }
    
    // Establecer foto principal
    const imgPrincipal = document.getElementById('imgPrincipal');
    imgPrincipal.src = fotosArray[0];
    imgPrincipal.onerror = function() {
      this.src = 'https://via.placeholder.com/1200x800?text=Sin+Imagen';
    };
    
    // Crear thumbnails
    const thumbnailsContainer = document.getElementById('thumbnailsContainer');
    thumbnailsContainer.innerHTML = '';
    
    fotosArray.forEach((foto, index) => {
      const thumbnail = document.createElement('div');
      thumbnail.className = 'thumbnail' + (index === 0 ? ' active' : '');
      
      const img = document.createElement('img');
      img.src = foto;
      img.alt = `Foto ${index + 1}`;
      img.onerror = function() {
        this.src = 'https://via.placeholder.com/400x300?text=Sin+Imagen';
      };
      
      thumbnail.appendChild(img);
      
      // Click en thumbnail cambia foto principal
      thumbnail.addEventListener('click', () => {
        // Cambiar foto principal
        document.getElementById('imgPrincipal').src = foto;
        
        // Actualizar clase active
        document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
        thumbnail.classList.add('active');
      });
      
      thumbnailsContainer.appendChild(thumbnail);
    });
    
    console.log(`‚úÖ Galer√≠a cargada con ${fotosArray.length} foto(s)`);
  }
  
  // ===== MOSTRAR ERROR =====
  function mostrarError(mensaje) {
    const mensajeCarga = document.getElementById('mensajeCarga');
    mensajeCarga.innerHTML = `
      <div class="mensaje-error" style="text-align: center; padding: 40px;">
        <h2 style="color: #d32f2f; margin-bottom: 15px;">‚ö†Ô∏è ${mensaje}</h2>
        <p style="color: #666; margin-bottom: 20px;">La propiedad que buscas no est√° disponible.</p>
        <a href="propiedades.html" class="btn-volver" style="display: inline-flex; margin: 0 auto; position: static; transform: none;">
          ‚Üê Volver al listado
        </a>
      </div>
    `;
  }
  
  // ===== INICIALIZACI√ìN =====
  document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ M√≥dulo Detalle de Propiedad cargado');
    cargarPropiedad();
  });
</script>

<script src="header.js"></script>
</body>
</html>